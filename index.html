<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>栁。と申します</title>
  <link rel="icon" type="image/png" href="img/favicon.png">
  <link rel="stylesheet" href="css/style.css">
  <style>

  </style>
</head>
<body>
  <div class="container">
    <header class="profile-header">
      <div class="banner" id="banner">
        <div class="header-overlay">
          <div class="avatar"><img src="img/icon.png" alt="icon"></div>
          <nav class="socials">
            <a class="sns-btn" href="https://x.com/_ya_1025_" id="snsX" target="_blank">X</a>
            <a class="sns-btn" href="https://instagram.com/_ya_1025_" id="snsIG" target="_blank">Instagram</a>
            <a class="sns-btn" href="https://t.co/DRfJFcIgiJ" id="snsSkeb" target="_blank">Skeb</a>
            <a class="sns-btn" href="https://t.co/2CRviDmInW" id="snsMarsh" target="_blank">マシュマロ</a>
          </nav>
        </div>
      </div>
      <div class="profile-meta">
        <div class="name-line">
          <h1 id="displayName">栁。</h1>
          <span class="username" id="username">@_ya_1025_</span>
        </div>
        <ul class="info-line">
          <li><span>誕生日</span><strong id="birthday">10月25日</strong></li>
          <li><span>絵描き歴</span><strong id="years">5年</strong></li>
          <li><span>FAタグ</span><strong id="faTag"><a href="https://twitter.com/hashtag/ΔScopeFA" target="_blank">#ΔScopeFA</a></strong></li>
        </ul>
      </div>
       <div class="bio">
        <p>
          マシュマロをください！！

          無断転載・無断使用・AI学習✖︎

        </p>
      </div>
    </header>
    <div class="tabs">
  <button class="tab-btn active" data-tab="illust">イラスト</button>
  <button class="tab-btn" data-tab="other1">創作(まだ)</button>
  <button class="tab-btn" data-tab="board">匿名掲示板</button>
</div>
<main>
  <div id="tab-illust" class="tab-content active">
    <div class="controls">
      <div id="tagButtons"></div>
    </div>
    <div class="grid" id="gallery"></div>
  </div>

  <div id="tab-other1" class="tab-content">
    <p style="color:var(--muted)">コンテンツ未定です。</p>
  </div>
  <div id="tab-board" class="tab-content">
    <section class="board">
      <form id="b-form" class="board-form">
        <input id="b-name" placeholder="名前">
        <hr>
        <textarea id="b-msg" placeholder="なんか書いて"></textarea>
        <div class="submit-wrapper">
          <button type="submit">ATTACK</button>
        </div>
      </form>
      <ul id="b-list" class="board-list"></ul>
    </section>
  </div>
</main>

</main>

    <footer>©willsident.com</footer>
  </div>

  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal-left"><img id="modalImg" alt="作品画像"></div>
      <div class="modal-right">
        <div class="modal-controls">
          <div class="nav-group">
            <button class="icon-btn" id="prevBtn" title="前の作品" aria-label="前の作品">◀</button>
            <span class="pager" id="pagerText">1 / 1</span>
            <button class="icon-btn" id="nextBtn" title="次の作品" aria-label="次の作品">▶</button>
          </div>
          <button class="icon-btn close" id="closeBtn" aria-label="閉じる">✕</button>
        </div>
        <div style="display:flex;justify-content:space-between;align-items:start;gap:12px">
          
          <div>
            <h2 id="modalTitle" style="margin:0 0 6px">title</h2>
            <p id="modalDate" style="margin:0 0 8px;color:var(--muted);font-size:13px">製作: YYYY-MM</p>
          </div>
        </div>
        <p id="modalDesc" style="margin:0 0 12px;color:var(--muted)">yo</p>
        <div class="modal-tags" id="modalTags"></div>


      </div>
    </div>
  </div>

  <script src="js/illstdata.js"></script>
  <script>
    let filtered = ARTWORKS.slice();
    let activeTags = new Set();
    let currentIndex = -1;

    const gallery = document.getElementById('gallery');
    const tagButtons = document.getElementById('tagButtons');
    const modal = document.getElementById('modal');
    const modalImg = document.getElementById('modalImg');
    const modalTitle = document.getElementById('modalTitle');
    const modalDesc = document.getElementById('modalDesc');
    const modalTags = document.getElementById('modalTags');
    const modalDate = document.getElementById('modalDate');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const closeBtn = document.getElementById('closeBtn');
    const pagerText = document.getElementById('pagerText');

    function renderTagButtons(){
      tagButtons.innerHTML='';
      const allBtn = document.createElement('button');
      allBtn.className = 'tag-btn all' + (activeTags.size===0?' active':'');
      allBtn.textContent = 'すべて';
      allBtn.addEventListener('click',()=>{ activeTags.clear(); applyFilters(); renderTagButtons(); });
      tagButtons.appendChild(allBtn);

      getAllTags().forEach(t=>{
        const btn = document.createElement('button');
        btn.className = 'tag-btn' + (activeTags.has(t)?' active':'');
        btn.dataset.tag = t;
        btn.textContent = t;
        btn.addEventListener('click',()=>{
          if(activeTags.has(t)) activeTags.delete(t); else activeTags.add(t);
          applyFilters(); renderTagButtons();
        });
        tagButtons.appendChild(btn);
      });
    }

    function applyFilters(){
      filtered = ARTWORKS.filter(a=>{
        if(activeTags.size>0){ for(const t of activeTags){ if(!a.tags.includes(t)) return false; } }
        return true;
      });
      renderGallery();
    }

    function renderGallery(){
      gallery.innerHTML='';
      if(filtered.length===0){ gallery.innerHTML = '<p style="color:var(--muted)">該当する作品がありません。</p>'; return }
      filtered.forEach((a,idx)=>{
        const card = document.createElement('article');
        card.className='card';
        card.innerHTML = `
          <div class="thumb"><img loading="lazy" src="${a.img}" alt="${a.title}"></div>
          <div class="card-body">
            <div class="card-header-line">
              <h3 class="card-title">${a.title}</h3>
              <div class="card-tags">${(a.tags||[]).map(t=>`<span class=\"pill\" data-tag=\"${t}\">${t}</span>`).join('')}</div>
            </div>
          </div>`;
        card.addEventListener('click',()=>openModal(idx));
        card.addEventListener('keydown',(e)=>{ if(e.key==='Enter') openModal(idx); });
        gallery.appendChild(card);
      });
    }

    function openModal(idx){
      currentIndex = idx;
      const art = filtered[currentIndex];
      if(!art) return;
      modalImg.src = art.img;
      modalTitle.textContent = art.title;
      modalDesc.textContent = art.desc || '';
      modalDate.textContent = '製作: ' + (art.date || '');
      modalTags.innerHTML = (art.tags||[]).map(t=>`<span class="pill" data-tag="${t}">${t}</span>`).join('');
      pagerText.textContent = `${filtered.indexOf(art)+1} / ${filtered.length}`;
      modal.classList.add('open');
      closeBtn.focus();
    }
    function closeModal(){ modal.classList.remove('open'); currentIndex=-1; }
    function showNext(){ if(filtered.length===0) return; currentIndex = (currentIndex+1)%filtered.length; openModal(currentIndex); }
    function showPrev(){ if(filtered.length===0) return; currentIndex = (currentIndex-1+filtered.length)%filtered.length; openModal(currentIndex); }

    closeBtn.addEventListener('click', closeModal);
    nextBtn.addEventListener('click', showNext);
    prevBtn.addEventListener('click', showPrev);
    modal.addEventListener('click',(e)=>{ if(e.target===modal) closeModal(); });
    document.addEventListener('keydown',(e)=>{
      if(e.key==='Escape') closeModal();
      if(modal.classList.contains('open')){
        if(e.key==='ArrowRight') showNext();
        if(e.key==='ArrowLeft') showPrev();
      }
    });

    renderTagButtons();
    applyFilters();

    // タブ切り替え処理
const tabButtons = document.querySelectorAll('.tab-btn');
const tabContents = document.querySelectorAll('.tab-content');

tabButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    // ボタンの active 切替
    tabButtons.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');

    // コンテンツの active 切替
    tabContents.forEach(c => c.classList.remove('active'));
    document.getElementById('tab-' + btn.dataset.tab).classList.add('active');
  });
});
  </script>
  <script>
  // ======== タブ切替（既存に追記） ========
  tabButtons.forEach(btn => {
    btn.addEventListener('click', async () => {
      tabButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      tabContents.forEach(c => c.classList.remove('active'));
      const activeId = 'tab-' + btn.dataset.tab;
      document.getElementById(activeId).classList.add('active');

      // ★ 掲示板タブが初めて開かれたら初期化
      if (btn.dataset.tab === 'board') {
        await initBoardOnce();
      }
    });
  });

  // ======== 掲示板（TEST.html の機能を移植） ========
  let boardInited = false;
  async function initBoardOnce(){
    if (boardInited) return;
    boardInited = true;

    // Firebase SDK を動的ロード（TEST.html と同等のバージョン）:contentReference[oaicite:6]{index=6}
    const [{ initializeApp }, { getFirestore, collection, addDoc, query, orderBy, onSnapshot, deleteDoc, doc, getDoc, setDoc }, { getAuth, signInAnonymously, onAuthStateChanged }] =
      await Promise.all([
        import("https://www.gstatic.com/firebasejs/9.6.11/firebase-app.js"),
        import("https://www.gstatic.com/firebasejs/9.6.11/firebase-firestore.js"),
        import("https://www.gstatic.com/firebasejs/9.6.11/firebase-auth.js")
      ]);

    const firebaseConfig = {
      apiKey: "AIzaSyDu7kx3msV9CvOzxD9ilKmWfzkT3YHFcMg",
      authDomain: "willsident-pj.firebaseapp.com",
      projectId: "willsident-pj",
      storageBucket: "willsident-pj.firebasestorage.app",
      messagingSenderId: "791017364363",
      appId: "1:791017364363:web:b2f1408377544c4de6ed8e"
    }; // :contentReference[oaicite:7]{index=7}

    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);
    const auth = getAuth(app);

    const form = document.getElementById('b-form');
    const nameI = document.getElementById('b-name');
    const msgI  = document.getElementById('b-msg');
    const list  = document.getElementById('b-list');

    let uid = null;

    // 匿名サインイン & 以降のロジック（TEST.html を踏襲）:contentReference[oaicite:8]{index=8}
    signInAnonymously(auth);
    onAuthStateChanged(auth, user => {
      if (!user) return;
      uid = user.uid;

      form.onsubmit = async (e) => {
        e.preventDefault();
        if (!nameI.value || !msgI.value) return;
        await addDoc(collection(db, "comments"), {
          name: nameI.value,
          message: msgI.value,
          timestamp: new Date(),
          uid: uid
        });
        nameI.value = "";
        msgI.value = "";
      };

      const q = query(collection(db, "comments"), orderBy("timestamp", "desc"));
      onSnapshot(q, snap => {
        list.innerHTML = "";
        snap.forEach(d => {
          const c = d.data(), id = d.id;
          const li = document.createElement("li");
          const date = c.timestamp.toDate().toLocaleString("ja-JP");
          const likesCol = collection(db, "comments", id, "likes");

          li.innerHTML = `
            <div><span class="name">${c.name}</span><span class="date">${date}</span></div>
            <div class="message">${c.message}</div>
            ${uid === c.uid ? `<button class="delete-btn" data-id="${id}">削除</button>` : ""}
            <span class="likes" data-id="${id}">♡ ...</span>
          `;
          list.appendChild(li);

          onSnapshot(likesCol, async (likeSnap) => {
            const likeCount = likeSnap.size;
            const likeDoc = await getDoc(doc(likesCol, uid));
            const liked = likeDoc.exists();
            const likesSpan = li.querySelector(".likes");
            likesSpan.innerHTML = `
              <button class="like-btn ${liked ? 'liked' : ''}" data-id="${id}" data-liked="${liked}">
                ▲ ${likeCount}
              </button>
            `;
            likesSpan.querySelector(".like-btn").onclick = async () => {
              const likeRef = doc(db, "comments", id, "likes", uid);
              if (liked) await deleteDoc(likeRef);
              else await setDoc(likeRef, { liked: true });
            };
          });
        });

        // 削除
        list.querySelectorAll(".delete-btn").forEach(b => {
          b.onclick = () => {
            const id = b.dataset.id;
            deleteDoc(doc(db, "comments", id));
          };
        });
      });
    });
  }

  // ページ初期表示を「イラスト」タブにしている場合は、掲示板は未ロードのまま。
  // ページを軽く保てます:contentReference[oaicite:9]{index=9}。
</script>

</body>
</html>